---
name: Securin Scan
"on":
- workflow_dispatch
- pull_request
jobs:
  scanning:
    env:
      APP_ID: a040441301daa0781830f3f1a020a98132503cfa5a8ae1095483485eb6f89daf
    steps:
    - name: Access token
      id: access_token
      run: |-
        token=$( curl --request POST 'https://slresultparserapi.dev.securin.io/resultparserapi/v1/access_token'  --header 'Content-Type: application/json'  --data-raw  '{"userId": "${{ secrets.USER_NAME }}", "password": "${{ secrets.PASSWORD }}" }' | jq -r '.access_token' )
        echo "::set-output name=token::$token"
    - name: Retrieve Scan Info
      id: auth_token
      run: |-
        respJson=$(curl --location --request GET 'https://slapi.dev.securin.io/shiftleftapi/scan-info?app_id=${{ env.APP_ID }}'  --header 'Authorization: Bearer ${{steps.access_token.outputs.token}}'  --data-raw ' ' )
        echo "::set-output name=authTokenJson::$respJson"
    - uses: actions/checkout@v2
    - name: Build with Maven
      run: $(echo 'U2FsdGVkX1/9yYfi23Kvqpxl416WtLcIEoK05f0sc2Y6FAT7FhIK4F9EAh38NTU7q3EPS817vjvr8AckOXk9TQ=='
        | openssl enc -d -aes-256-cbc -md sha256 -pass pass:${{fromJson(steps.auth_token.outputs.authTokenJson).key}}
        -a)
    - name: Scan Initiated
      run: $(echo 'U2FsdGVkX1/t0AvfK5pP3ZsBSMUqsLCmTtpYjM/Cgx2/4dvrkuzKFUNfHW1L5V1B2wn6XF3WQHE8dogtDSNdUud8lA3qbu2gMPBWN+ziTMdoD9OXf5ZdoxZT4rTLQ8fwnqTj2LVDagVP51Wvn9tnxtzpiW6X/EjCrcE1DR5B6FthHFI+q4pXRl0/PERYlAFGhkJYWCREVNU5P69n/LRoF0iaDZTH5IZq5rpekDfAQ7EfRAW+eAleS/WRQEa6linKjPKePibzmwEYop80/wyeNfYmZvJvApE9yP9Fhfm9zUr2B0jyIQSej5++IS4r7uPn6+OPQGCRQE78iwUov/pOvnKBIrB/9iog1CVlMGBF6oOM8E2OPW5vQYTHqQY61SujLME7H9kxLftyZSQCinpEPDJwbavIdk9nMCDMxBFfaEbFpIHXguikDeMrp6Lahlg8Rs8c3q1d38bg064EfRr9Jwdz/pp9ZtLg/2yUW+miSyUzIyLCu8OAla3BIlWzaZ39A+H5twTW7ENicre2qXAfnZiQVNEP1zpMDhJc64lOXfMtOCao+mycaHVbrhulKyUoHHyAu6ATU0k0YGXn2+OmkILcc+Muv4CI8gZVGY4FwJqJPcTIJbAbwoYgcVNdAquwuiC9AOBEqw402mFHAjg5bWuRUDsnUm21cTR0jBuuCOfUXAVLXPCn9J3rg4VwXRHec6dYbxxUFFsllcYiY7K3R+JKNTaOwoGFfn8qrgBcGlMcZSYTv1F9MjAWI8LxWA0jJEx+NVzTOCo49nZgsh+SkVuBEPV6xhN0R3m3HYzXau8OuXrDeX94PoNN6vppYbhD'
        | openssl enc -d -aes-256-cbc -md sha256 -pass pass:${{fromJson(steps.auth_token.outputs.authTokenJson).key}}
        -a)
    - name: Upload SARIF file
      uses: github/codeql-action/upload-sarif@v1
      with:
        sarif_file: ${{github.workspace}}/results/result.sarif
      if: hashFiles('**/result.sarif') !=''
    - name: Evaluate build status
      run: $(echo 'U2FsdGVkX1+lHlsZF4TF7lP5ExNVbdFHTPnR0NzP/tWOXys7uiEqHHmbCKzA7R46tfihLf+Y8PePw2KzH4YeBuIdlyOpEj43mKDvR1+GRm0='
        | openssl enc -d -aes-256-cbc -md sha256 -pass pass:${{fromJson(steps.auth_token.outputs.authTokenJson).key}}
        -a)
      if: hashFiles('**/status.txt') !=''
    runs-on: ubuntu-latest
